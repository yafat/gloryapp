<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<!-- meta -->
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="initial-scale=1, maximum-scale=1, width=device-width" />
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="mobile-web-app-capable" content="yes">
<meta http-equiv="Content-Security-Policy"/>
<title>GLORY</title>
<!-- CSS -->
<link href="css/font-awesome.min.css" rel="stylesheet">
<link href="css/swiper.min.css" rel="stylesheet">
<link href="css/jquery-ui.min.css" rel="stylesheet">
<link href="css/jquery-ui.structure.min.css" rel="stylesheet">
<link href="css/style.css" rel="stylesheet">
<link href="css/yafat.css" rel="stylesheet">
<!-- JS -->
<script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
<script src="js/jquery.min.js"></script>
<script src="js/jquery-migrate-1.2.1.min.js"></script>
<script src="js/swiper.min.js"></script>
<script src="js/jquery-ui.min.js"></script>
<script src="js/jquery.form.js"></script>
<script src="js/js.cookie.js"></script>
<script src="js/jcanvas.min.js"></script>
<script src="js/script.js"></script>
<script src="js/pic.js"></script>
<!-- clm to get face landmark dynamically -->
<script src="js/clmtrackr.js"></script>
<script src="js/model_pca_20_svm.js"></script>
<!-- pixastic to change the image style -->
<script src="js/pixastic.js"></script>
<script src="js/pixastic.effects.js"></script>
<script src="js/pixastic.worker.js"></script>
<!-- monaca components -->
<link rel="stylesheet" href="components/loader.css">
<script src="components/loader.js"></script>

</head>
<body>
    <div class="pink_bg pag pag-init no-header">
        <img id="Welcome_page" src="images/Welcome_page.jpg" /> 
    </div>
    <div class="pink_bg pag pag-index">
        
        <main class="index_slider_block">
            <!-- Swiper -->
            <div id="index_sliders" class="swiper-container">
                <div class="swiper-wrapper">
                    <div class="swiper-slide"><img src="images/banner_1.png"></div>
                    <div class="swiper-slide"><img src="images/banner_2.png"></div>
                    <div class="swiper-slide"><img src="images/banner_3.png"></div>
                </div>
                <!-- Add Pagination -->
                <div class="swiper-pagination"></div>
            </div>
        </main>
        <footer class="index_menu_block">
            <a class="quick_makeup_btn" ><img src="images/quick_makeup.png"><p>快捷化妝</p></a>
            <a onclick="show_page('.pag-picture')"><img src="images/choice_style.png"><p>選擇樣式</p></a>
            <a onclick="show_page('.pag-camera')"><img src="images/take_photo.png"><p>拍照</p></a>
            <a onclick="show_page('.pag-settings')" id="nav-btn-list"><i class="fa fa-cog index-setting-icon"></i><p>設定</p></a>
            <div class="clear"></div>
        </footer>
    </div>
    <div class="pink_bg pag pag-login">
        <main class="login_form_block">
            <img class="white_logo" src="images/logo.png">
            <form id="login-form">
                <div class="form-flat">
                <input type="text" name="loginid" id="loginid" value="" placeholder="輸入帳號" />
                <input type="text" name="passwd" id="passwd" value="" placeholder="輸入密碼" />
                </div>
                <a onclick="login();" class="white_btn">LOGIN<i class="fa fa-angle-right"></i></a>
            </form>
            <a onclick="show_page('.pag-register')" class="white_btn link_title registered_member">註冊會員</a>
            <div class="forgot_username_block">
                <h2>忘記帳號</h2>
                <div class="form-flat">
                    <input type="text" name="forget-email" id="forget-email" value="" placeholder="請輸入您的手機號碼" />
                </div>
                <a onclick="send_forget('loginid');" class="white_btn">CONFIRM<i class="fa fa-angle-right"></i></a>
                <p>我們將以簡訊傳送給您</p>
            </div>
            <div class="forgot_password_block">
                <h2>忘記密碼</h2>
                <div class="form-flat">
                    <input type="text" name="forget-loginid" id="forget-loginid" value="" placeholder="請輸入您的Email" />
                </div>
                <a onclick="send_forget('passwd');" class="white_btn">CONFIRM<i class="fa fa-angle-right"></i></a>
                <p>我們將把密碼寄至您信箱</p>
            </div>
        </main>
        <footer class="login_form_footer">
            <div class="forgot_username">
            <a onclick="show_forget('loginid');" class="white_btn">忘記帳號</a></div>
            <div class="forgot_password">
            <a onclick="show_forget('passwd');" class="white_btn">忘記密碼</a>
            </div>
            <div class="clear"></div> 
        </footer> 
    </div>
    <div class="pink_bg pag pag-register">
        <main class="login_form_block">
            <img class="white_logo" src="images/logo.png">
            <div class="register_block">
                <form action="" method="post" id="register_form">
                    <div class="form-flat">
                    <input type="text" name="reg_loginid" id="reg_loginid" placeholder="設定您的帳號" />
                    <input type="password" name="reg_passwd" id="reg_passwd" placeholder="設定您的密碼" />
                    <input type="password" name="reg_passwd_chk" id="reg_passwd_chk" placeholder="確認密碼" />
                    </div>
                    <a class="white_btn register_toggle_btn">NEXT STEP<i class="fa fa-angle-right"></i></a>
                </form>
                <a onclick="show_page('.pag-login')" class="link_title registered_member">取消註冊</a>
            </div>
            <div class="edit_member_block">
                <form action="" method="post" id="register_info">
                    <div class="form-flat">
                    <input type="text" name="reg_name" id="reg_name" placeholder="設定您的姓名" />
                    <input type="text" name="reg_email" id="reg_email" placeholder="設定Email" />
                    <input type="text" name="reg_mobile" id="reg_mobile" placeholder="設定手機號碼" />
                    </div>
                    <a class="white_btn register_toggle_btn">BACK<i class="fa fa-angle-right"></i></a>
                    <a onclick="edit_member('register')" class="white_btn register_btn">REGISTER<i class="fa fa-angle-right"></i></a>
                </form>
                <a onclick="show_page('.pag-login')" class="link_title registered_member">取消註冊</a>
            </div>
        </main>
    </div>
    <div class="pink_bg pag pag-config">
        <img class="white_logo" src="images/logo.png">
        <div class="pag-config-tabs">
            <a class="cfg-account-btn on">帳號 / 密碼</a>
            <a class="cfg-info-btn off">基本資料</a>
        </div>
        <form role="form" id="config-form" >
            <div class="cfg-account">
                <input type="text" name="loginid" id="cfg_loginid" value="" placeholder="設定您的帳號" />
                <input type="password" name="passwd" id="cfg_passwd" value="" placeholder="設定您的密碼" />
                <input type="password" name="chk_passwd" id="cfg_passwd_chk" value="" placeholder="確認密碼" />
            </div>
            <div class="cfg-info">
                <input type="text" name="name" id="cfg_name" value="" placeholder="設定您的姓名" />
                <input type="text" name="email" id="cfg_email" value="" placeholder="設定您的Email" />
                <input type="text" name="mobile" id="cfg_mobile" value="" placeholder="行動電話號碼" />
            </div>
            <a onclick="edit_member();" class="white_btn">SUBMIT<i class="fa fa-angle-right"></i></a>
        </form>
    </div>
    <div class="pink_bg pag pag-setup"></div>
    <div class="gray_bg pag pag-camera">
        <main class="photo_ready_block">
            <i class="fa fa-volume-up fa-5x"></i>
            <p>準備拍照中</p>
            <h5>請聽從語音提示進行拍照</h5>
            <a onclick="startProc('stop_camera')" class="pink_btn">CANCEL<i class="fa fa-angle-right"></i></a>
        </main>
    </div> <!--photo_ready-->
    <div class="gray_bg pag pag-picture">
        <main class="makeup_style_block">
            <div class="big_face_circle">
                <canvas id="photo_canvas" width="320" height="320"></canvas>
                <canvas id="makeup_canvas" width="320" height="320"></canvas>
                <div class="sho-points"></div>
            </div>
            <div class="big_circle_bg"></div>
            <a class="before_btn">更換照片</a>
            <a onclick="show_page('.pag-chk-inks')" id="makeup_btn" class="before_btn">MAKEUP</a>
            <img id="photo_img" src="" style="display:none" />
        </main>
        <footer class="makeup_style_footer makeup_style_lists" style="display:block">
            <div class="makeup_styles swiper-container">
                <div class="swiper-wrapper">
                    <div class="swiper-slide makeup_style_1 makeup_style_options" sn="1" onclick="choose_style('1');">
                        <img src="images/face1.png">
                        <i class="fa fa-check" style="display: none;"></i>
                        <div class="makeup_style_name">都會知性</div>
                    </div>
                    <div class="swiper-slide makeup_style_2 makeup_style_options" sn="2" onclick="choose_style('2');">
                        <img src="images/face2.png">
                        <i class="fa fa-check" style="display: none;"></i>
                        <div class="makeup_style_name">氣質甜美</div>
                    </div>
                    <div class="swiper-slide makeup_style_3 makeup_style_options" sn="3" onclick="choose_style('3');">
                        <img src="images/face3.png">
                        <i class="fa fa-check" style="display: none;"></i>
                        <div class="makeup_style_name">時尚名媛</div>
                    </div>
                    <div class="swiper-slide makeup_style_options makeup_style_add">
                        <i class="fa fa-plus"></i>
                    </div>
                </div>
            </div>
            <div class="makeup_style_funcs" id="main_funcs">
                <div id="main_funcs_text">Please choose a style above</div>
                <a class="link_title left_side btn_style_edit"><i class="fa fa-pencil"></i>EDIT</a>
                <a class="link_title center_side" onclick="doShare()"><i class="fa fa-share-alt"></i>SHARE</a>
                <a class="link_title right_side" onclick="show_page('.pag-manual')"><i class="fa fa-question"></i>HELP</a>
            </div>
        </footer>
        <footer class="makeup_style_footer makeup_style_editor swiper-container" style="display:none">
            <div class="swiper-wrapper">
                <div class="swiper-slide">
                    <div class="footer_title"><img src="images/pressed_powder_icon.png"><span>PRESSED POWDER</span></div>
                    <div step="foundation" class="fundation_style_list">
                        <div class="footer_list footer_list_no1  c103" colorsn="103" onclick="draw_foundation('103')">
                            <div class="footer_list_name">Darker</div>
                        </div>
                        <div class="footer_list footer_list_no2 c104" colorsn="104" onclick="draw_foundation('104')">
                            <div class="footer_list_name">&nbsp;</div>
                        </div>
                        <div class="footer_list footer_list_no3 c105" colorsn="105" onclick="draw_foundation('105')">
                            <div class="footer_list_name">Normal</div>
                        </div>
                        <div class="footer_list footer_list_no4 c106" colorsn="106" onclick="draw_foundation('106')">
                            <div class="footer_list_name">&nbsp;</div>
                        </div>
                        <div class="footer_list footer_list_no5 c107" colorsn="107" onclick="draw_foundation('107')">
                            <div class="footer_list_name">Lighter</div>
                        </div>
                    </div>
                    <div class="clear"></div>
                    <div class="makeup_style_funcs">
                        <a class="link_title left_side btn_style_edit trio"><i class="fa fa-times-circle-o"></i>BACK</a>
                        <a onclick="save_styleName('新增樣式')" class="link_title center_side trio btn_detail_edit"><i class="fa fa-pencil"></i>SAVE</a>
                        <a onclick="show_page('.pag-manual')" class="link_title right_side trio"><i class="fa fa-question"></i>HELP</a>
                    </div>
                </div>
                <div class="swiper-slide">
                    <div class="style_chooser">
                        <div class="footer_title"><img src="images/blush_icon.png"><span>BLUSH</span></div>
                        <div step="blush" class="blush_style_list">
                            <div class="footer_list" sn="1">
                                <img src="images/blush_style1.png" />
                            </div>
                            <div class="footer_list" sn="2">
                                <img src="images/blush_style2.png" />
                            </div>
                            <div class="footer_list" sn="3">
                                <img src="images/blush_style3.png" />
                            </div>
                            <div class="footer_list" sn="4">
                                <img src="images/blush_style4.png" />
                            </div>
                        </div>
                        <div class="clear"></div>
                        <div class="makeup_style_funcs">
                            <a class="link_title left_side btn_style_edit trio"><i class="fa fa-times-circle-o"></i>BACK</a>
                            <a onclick="save_styleName('新增樣式')" class="link_title center_side trio btn_detail_edit"><i class="fa fa-pencil"></i>SAVE</a>
                            <a onclick="show_page('.pag-manual')" class="link_title right_side trio"><i class="fa fa-question"></i>HELP</a>
                        </div>
                    </div>
                    <div step="blush" class="area_editors blush_editors">
                        <div class="area_colors swiper-no-swiping">
                            <div class="area_color">
                                <div class="area_circle" id="area_circle_A">A</div>
                                <div class="area_color_list_container">
                                    <ul class="area_color_list">
                                        <li><div class="c201" colorsn="201"></div></li>
                                        <li><div class="c202" colorsn="202"></div></li>
                                        <li><div class="c312" colorsn="312"></div></li>
                                        <li><div class="c322" colorsn="322"></div></li>
                                        <li><div class="c401" colorsn="401"></div></li>
                                        <li><div class="c402" colorsn="402"></div></li>
                                    </ul>
                                </div>
                            </div>
<!--                             <div class="area_color">
                                <div class="area_circle" id="area_circle_B">B</div>
                                <div class="area_color_list_container">
                                    <ul class="area_color_list">
                                        <li><div class="c201" colorsn="201"></div></li>
                                        <li><div class="c202" colorsn="202"></div></li>
                                        <li><div class="c312" colorsn="312"></div></li>
                                        <li><div class="c322" colorsn="322"></div></li>
                                        <li><div class="c401" colorsn="401"></div></li>
                                        <li><div class="c402" colorsn="402"></div></li>
                                    </ul>
                                </div>
                            </div> -->
                        </div>
                        <div class="area_move">
                            <a class="area-move-up"><i class="fa fa-angle-up"></i></a>
                            <a class="area-move-left"><i class="fa fa-angle-left"></i></a>
                            <a class="area-move-down"><i class="fa fa-angle-down"></i></a>
                            <a class="area-move-right"><i class="fa fa-angle-right"></i></a>
                        </div>
                    </div>
                </div>
                <div class="swiper-slide">
                    <div class="style_chooser">
                        <div class="footer_title"><img src="images/eyeshadow_icon.png"><span>EYESHADOW</span></div>
                        <div step="eyeshadow" class="eye_style_list">
                            <div class="footer_list"  sn="1">
                                <img src="images/eye_style1.png" />
                            </div>
                            <div class="footer_list"  sn="2">
                                <img src="images/eye_style2.png" />
                            </div>
                            <div class="footer_list" sn="3">
                                <img src="images/eye_style3.png" />
                            </div>
                        </div>
                        <div class="clear"></div>
                        <div class="makeup_style_funcs">
                            <a class="link_title left_side btn_style_edit trio"><i class="fa fa-times-circle-o"></i>BACK</a>
                            <a onclick="save_styleName('新增樣式')" class="link_title center_side trio btn_detail_edit"><i class="fa fa-pencil"></i>SAVE</a>
                            <a onclick="show_page('.pag-manual')" class="link_title right_side trio"><i class="fa fa-question"></i>HELP</a>
                        </div>
                    </div>
                    <div step="eyeshadow" class="area_editors eyeshadow_editors">
                        <div class="area_colors swiper-no-swiping">
                            <div class="area_color">
                                <div class="area_circle" id="area_circle_A">A</div>
                                <div class="area_color_list_container">
                                    <ul class="area_color_list">
                                        <li><div colorsn="312" class="c312"></div></li>
                                        <li><div colorsn="315" class="c315"></div></li>
                                        <li><div colorsn="316" class="c316"></div></li>
                                        <li><div colorsn="322" class="c322"></div></li>
                                        <li><div colorsn="327" class="c327"></div></li>
                                        <li><div colorsn="328" class="c328"></div></li>
                                        <li><div colorsn="330" class="c330"></div></li>

                                    </ul>
                                </div>
                            </div>
                            <div class="area_color">
                                <div class="area_circle" id="area_circle_B">B</div>
                                <div class="area_color_list_container">
                                    <ul class="area_color_list">
                                        <li><div colorsn="312" class="c312"></div></li>
                                        <li><div colorsn="315" class="c315"></div></li>
                                        <li><div colorsn="316" class="c316"></div></li>
                                        <li><div colorsn="322" class="c322"></div></li>
                                        <li><div colorsn="327" class="c327"></div></li>
                                        <li><div colorsn="328" class="c328"></div></li>
                                        <li><div colorsn="330" class="c330"></div></li>
                                    </ul>
                                </div>
                            </div>
                            <div class="area_color">
                                <div class="area_circle" id="area_circle_C">C</div>
                                <div class="area_color_list_container">
                                    <ul class="area_color_list">
                                        <li><div colorsn="312" class="c312"></div></li>
                                        <li><div colorsn="315" class="c315"></div></li>
                                        <li><div colorsn="316" class="c316"></div></li>
                                        <li><div colorsn="322" class="c322"></div></li>
                                        <li><div colorsn="327" class="c327"></div></li>
                                        <li><div colorsn="328" class="c328"></div></li>
                                        <li><div colorsn="330" class="c330"></div></li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="area_move">
                            <a class="area-move-up"><i class="fa fa-angle-up"></i></a>
                            <a class="area-move-left"><i class="fa fa-angle-left"></i></a>
                            <a class="area-move-down"><i class="fa fa-angle-down"></i></a>
                            <a class="area-move-right"><i class="fa fa-angle-right"></i></a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="swiper-navigator">
                <i class="fa fa-angle-left makeup_editor_prev"></i>
                <i class="fa fa-angle-right makeup_editor_next"></i>
            </div>
        </footer>
    </div>
    <div class="gray_bg pag pag-chk-inks">
        <main class="color_check_block">
            <i class="fa fa-cog fa-spin fa-5x" style="color:#df6f6f;"></i>
            <p>檢查色閘中...</p>
            <div style="padding:10%">請耐心等候系統回傳色匣資訊。</div>
        </main>
        <main class="color_detection_block" style="display:none;">
            <div class="bg_circle"><!--<i class="fa fa-exclamation-circle"></i>-->
                <div class="sm_circle sm_circle_1">
                    <div class="ink_status"></div>
                    <div class="ink_number">103</div>
                    <div class="ink_alert"><i class="fa fa-exclamation"></i></div>
                </div>
                <div class="sm_circle sm_circle_2">
                    <div class="ink_status"></div>
                    <div class="ink_alert"><i class="fa fa-exclamation"></i></div>
                    <div class="ink_number">106</div>
                </div>
                <div class="sm_circle sm_circle_3">
                    <div class="ink_status"></div>
                    <div class="ink_number">107</div>
                    <div class="ink_alert"><i class="fa fa-exclamation"></i></div>
                </div>
                <div class="sm_circle sm_circle_4">
                    <div class="ink_number">201</div>
                    <div class="ink_status"></div>
                    <div class="ink_alert"><i class="fa fa-exclamation"></i></div>
                </div>
                <div class="sm_circle sm_circle_5">
                    <div class="ink_number">202</div>
                    <div class="ink_status"></div>
                    <div class="ink_alert"><i class="fa fa-exclamation"></i></div>
                </div>
                <div class="sm_circle sm_circle_6">
                    <div class="ink_number">312</div>
                    <div class="ink_status"></div>
                    <div class="ink_alert"><i class="fa fa-exclamation"></i></div>
                </div>
                <div class="sm_circle sm_circle_7">
                    <div class="ink_number">315</div>
                    <div class="ink_status"></div>
                    <div class="ink_alert"><i class="fa fa-exclamation"></i></div>
                </div>
                <div class="sm_circle sm_circle_8">
                    <div class="ink_number">316</div>
                    <div class="ink_status"></div>
                    <div class="ink_alert"><i class="fa fa-exclamation"></i></div>
                </div>
                <div class="sm_circle sm_circle_0">
                    <div class="ink_clean">cleaning<br />solution</div>
                    <div class="ink_status"></div>
                </div>
            </div>
<!--             <a id="btnStartMakeup" class="pink_btn" onclick="check_ink();">RELOAD<i class="fa fa-angle-right"></i></a> -->
            <a onclick="" class="pink_btn">SHOPPING ONLINE<i class="fa fa-angle-right"></i></a>
        </main>
    </div>
    <div class="gray_bg pag pag-makeup">
        <main class="photo_ready_block">
            <i class="fa fa-volume-up fa-5x"></i>
            <p>準備上妝</p>
            <h5>請聽從語音提示開始上妝步驟</h5>
            <a onclick="show_page('.pag-makeup-step');" class="pink_btn">CONTINUE<i class="fa fa-angle-right"></i></a>
            <a onclick="startProc('stop_makeup');" class="pink_btn">STOP<i class="fa fa-angle-right"></i></a>
        </main>
    </div>
    <div class="pink_bg pag pag-stop-makeup">
        <main class="socket_error_block">
            <i class="fa fa-exclamation-triangle fa-5x error_link_icon"></i>
            <p class="link_title">使用者中止</p>
            <a onclick="show_page('.pag-makeup')" class="white_btn">CONTINUE<i class="fa fa-angle-right"></i></a>
        </main>
    </div>
    <div class="pink_bg pag pag-save-done"> 
        <main class="save-done-block">
            <i class="fa fa-floppy-o fa-5x"></i>
            <form action="" method="post" id="save_done_form">
                <p class="link_title"></p>
                <input type="text" id="new_styleName" class="stylename" name="stylename" placeholder="請命名" />
                <a class="white_btn styleName_save_btn" onclick="save_style();">SAVE<i class="fa fa-angle-right"></i></a>
                <div class="styleName_continue_btn overlap-msg">化妝樣式已儲存完畢。請按下方按鈕返回設計畫面。</div>
                <a onclick="show_page('.pag-picture')" class="white_btn styleName_continue_btn" onclick="save_continue();">CONTINUE<i class="fa fa-angle-right"></i></a>
            </form>
        </main>
    </div>
    <div class="gray_bg pag pag-makeup-step">
        <main class="photo_ready_block">
            <i class="fa fa-cog fa-spin fa-5x"></i>
            <h1>STEP <span id="cur_step"></span></h1>
            <a onclick="startProc('stop_makeup');" class="pink_btn">STOP<i class="fa fa-angle-right"></i></a>
        </main>
    </div>     
    <div class="gray_bg pag pag-chk-connect ignore-socket-err">
        <main class="link_error_block">
            <i class="fa fa-exclamation-triangle fa-5x error_link_icon"></i>
            <p>尚未設定連線</p>
            <a onclick="set_mode('fun');" class="pink_btn">離線模式<i class="fa fa-angle-right"></i></a>
            <div class="onlinemode_msg">
                <div >
                實機模式需要在與化妝機連線的狀態下才能使用。
                目前APP尚未連線到化妝機。
                <a onclick="show_page('.pag-socket-setup');" class="white_btn">設定連線<i class="fa fa-angle-right"></i></a>
                </div>
            </div>
         </main>
    </div>
    <div class="pink_bg pag pag-socket-error ignore-socket-err">
        <main class="socket_error_block">
            <i class="fa fa-exclamation-triangle fa-5x error_link_icon"></i>
            <p class="link_title">無法連線到化妝機</p>
            <a onclick="show_page('.pag-socket-setup')" class="white_btn">設定連線<i class="fa fa-angle-right"></i></a>
            <a onclick="set_mode('fun');" class="white_btn">離線模式<i class="fa fa-angle-right"></i></a>
        </main>
    </div>
    <div class="gray_bg pag pag-socket-setup ignore-socket-err">
        <main class="setup_block">
            <i class="fa fa-bluetooth fa-5x"></i>
            <div class="setup_title">
                <p id="bt-msg">化妝機連線設置</p>
            </div>     
            <div class="wifi_setup">
                <div class="form-group form-inline">
                    <div class="label">Host</div>
                    <input class="form-control" type="text" name="host" id="host" />
                </div>
                <div class="form-group form-inline">
                    <div class="label">Port</div>
                    <input class="form-control" type="text" name="port" id="port" />
                </div>
            </div>    
         </main>
         <footer>
            <a onclick="reconnect();" class="pink_btn">CONNECT<i class="fa fa-angle-right"></i></a>
            <a onclick="prev_page()" class="gray_btn">CANCEL<i class="fa fa-angle-right"></i></a>
         </footer>
    </div>
    <div class="gray_bg pag pag-style-all">
        <header>
            <div class="style_page_tilte">全部儲存的樣式</div>
        </header>
        <main class="style_all_block style-list">
            <ul>
                <!--<li><i class="fa fa-circle"></i>MAKEUP STYLE 1</li>-->
            </ul>
        </main>
        <footer class="style_all_footer">
            <a href="" class="link_title left_side"><i class="fa fa-file-text-o"></i>SAVE AS...</a>
            <div class="vertical_line"></div>
            <a href="" class="link_title right_side"><i class="fa fa-share-alt"></i>SHARE</a>     
        </footer>
    </div>
    <div class="gray_bg pag pag-style-new">
        <header>
            <div class="app_nav"><i class="fa fa-angle-left"></i><span>GLORY</span><i class="fa fa-bars"></i></div>
            <div class="style_page_tilte">儲存為新的樣式</div>
        </header>
        <main class="style_new_block">
            <form action="" method="post" id="stlye_new_form">
                <input type="text" name="stylename" placeholder="輸入名稱" />
                <a href="" onclick="document.getElementById('stlye_new_form').submit();" class="pink_btn">CONFIRM<i class="fa fa-angle-right"></i></a>
            </form>
            <a href="" class="link_title">取消儲存</a>
        </main>
    </div>
    <div class="pink_bg pag pag-about">
        <main class="use_about_block">
            <ul class="use_about_list">
                <li><i class="fa fa-chevron-left"></i>會員資料</li>
                <li>姓名<a onclick="user_settings_item('姓名','請輸入姓名')"><i class="fa fa-wrench"></i></a></li>
                <li>雲洛群</li>
                <li>電子郵件<a onclick="user_settings_item('電子郵件','請輸入Email')"><i class="fa fa-wrench"></i></a></li>
                <li>poney@gmail.com</li>
                <li class="setting_phone" >手機號碼<a onclick="user_settings_item('手機號碼','請輸入手機號碼')"><i class="fa fa-wrench"></i></a></li>
                <li>+886 922315678</li>
                <li>住家地址<a onclick="user_settings_item('住家地址','請輸入地址')"><i class="fa fa-wrench"></i></a></li>
                <li>新北市新店區中正路102巷7號1樓</li>
                <li>生日<a onclick="user_settings_item('生日','請輸入生日')"><i class="fa fa-wrench"></i></a></li>
                <li>1977/12/29</li>
            </ul>
        </main>     
    </div>
    <div class="pink_bg pag pag-contact"></div>
    <div class="gray_bg pag pag-manual">
        <main class="use_direction_block">
            <ul class="use_direction_list">
                <li><a onclick="show_page('.pag-picture')"><i class="fa fa-chevron-left"></i>使用說明</a></li>
                <li>步驟1</li>
                <li>啟動化妝機，確定運作燈已亮起。</li>
                <li>步驟2</li>
                <li>手機連線化妝機，進入APP程式。</li>
                <li>步驟3</li>
                <li>上傳手機原有照片或拍一張照片，選擇您要的妝感風格，調整您的粉底、腮紅與眼影顏色，點選修改可調整您上妝的區塊。</li>
                <li>步驟4</li>
                <li>妝容設定完成後，您可以儲存該妝容。點選 BRUSH 按鈕，則開始使用化妝機為您上妝，請注意語音提示配合操作。</li>
                <li>步驟5</li>
                <li>開始上妝。</li>
            </ul>
        </main>
    </div>
    <div class="gray_bg pag pag-msg">
        <main class="photo_error_block">
            <i class="fa fa-exclamation-triangle fa-5x error_link_icon"></i>
            <p class="link_title" id="pag-msg-title">系統訊息</p>
            <div class="link_content" id="pag-msg-content"></div>
            <a onclick="prev_page();"  class="pink_btn">BACK<i class="fa fa-angle-right"></i></a>
            <a onclick="show_page('.pag-manual');" class="pink_btn">HELP<i class="fa fa-angle-right"></i></a>
         </main>
    </div>
    <div class="gray_bg pag pag-bluetooth-scan">
        <main class="bluetooth_set_block">
            <i class="fa fa-bluetooth fa-5x"></i>
            <div class="bluetooth_scanning">
                <p id="bt-msg">藍芽裝置掃描中</p>
                <a href="#"  class="pink_btn" onclick="bt_turn_on();">TURN ON<i class="fa fa-angle-right"></i></a>
                <ul class="bluetooth_devices"> 
                    <li>Glory Makeup<i class="fa fa-check-circle-o"></i></li>
                    <li>藍芽裝置B</li>
                    <li>藍芽裝置D</li>
                    <li>藍芽裝置E</li>
                </ul>
            </div>     
            <div class="bluetooth_connected">
                <p>藍芽已連線到...</p>
                <ul class="bluetooth_devices"> 
                    <li>Glory Makeup</li>
                </ul>
            </div>   
         </main>
         <footer>
            <a onclick="prev_page();" class="pink_btn cancel_btn">CANCEL<i class="fa fa-angle-right"></i></a>
         </footer>
    </div>
    <div class="gray_bg pag pag-makeup-complete">
        <main class="makeup_complete_block">
        <h1>化妝完成</h1>
        <p>正在執行清潔動作...</p>
        <h5>您已可以離開此畫面</h5>
        <a onclick="show_page('.pag-index');" class="pink_btn">BACK HOME<i class="fa fa-angle-right"></i></a>
        </main>
    </div>
    <div class="pag pag-sigtest">
        <main>
        <i class="fa fa-cog fa-4x"></i>
        <h2 class="qa-title">訊號測試</h2>
        <!--<div><a onclick="sig_test('Cam_Check')" class="pink_btn sbt">相機狀態測試<i class="fa fa-angle-right"></i></a></div>
        <div><a onclick="sig_test('Robot_Check')" class="pink_btn sbt">機械狀態測試<i class="fa fa-angle-right"></i></a></div>
        <div><a onclick="sig_test('Ink_Check')" class="pink_btn sbt">色匣測試<i class="fa fa-angle-right"></i></a></div>
        <div><a onclick="sig_test('Ink_Low_Check')" class="pink_btn sbt">低墨測試<i class="fa fa-angle-right"></i></a></div>-->
        <div><a onclick="show_page('.pag-init-check')" class="pink_btn sbt">開機程序測試<i class="fa fa-angle-right"></i></a></div>
        <div class="pag-sigtest-item">
            <p class="pag-sigtest-title">相機狀態</p>
            <a onclick="send('cam_error', 'rbt');" class="pink_btn pag-sigtest-errorBtn"><i class="fa fa-times"></i>異常</a>            
            <a onclick="send('cam_ok', 'rbt');" class="pink_btn pag-sigtest-okBtn"><i class="fa fa-circle-o"></i>正常</a>
            <div class="clear"></div>
        </div>
        <div class="pag-sigtest-item">
            <p class="pag-sigtest-title">機械狀態</p>
            <a onclick="send('robot_error', 'rbt');" class="pink_btn pag-sigtest-errorBtn"><i class="fa fa-times"></i>異常</a>            
            <a onclick="send('robot_ok', 'rbt');" class="pink_btn pag-sigtest-okBtn"><i class="fa fa-circle-o"></i>正常</a>
            <div class="clear"></div>
        </div>
        <div class="pag-sigtest-item">
            <p class="pag-sigtest-title">使用者位移</p>
            <a onclick="send('move_error', 'rbt');" class="pink_btn pag-sigtest-errorBtn"><i class="fa fa-times"></i>異常</a>            
            <a onclick="send('move_ok', 'rbt');" class="pink_btn pag-sigtest-okBtn"><i class="fa fa-circle-o"></i>正常</a>
            <div class="clear"></div>
        </div>
        <div class="pag-sigtest-item">
            <p class="pag-sigtest-title">使用者中斷</p>
            <a onclick="send('stop_error', 'rbt');" class="pink_btn pag-sigtest-errorBtn"><i class="fa fa-times"></i>異常</a>            
            <a onclick="send('stop_ok', 'rbt');" class="pink_btn pag-sigtest-okBtn"><i class="fa fa-circle-o"></i>正常</a>
            <div class="clear"></div>
        </div>
        <div class="pag-sigtest-item">
            <p class="pag-sigtest-title">色閘異常</p>
            <a onclick="send('ink_error', 'rbt');" class="pink_btn pag-sigtest-errorBtn"><i class="fa fa-times"></i>異常</a>            
            <a onclick="send('ink_ok', 'rbt');" class="pink_btn pag-sigtest-okBtn"><i class="fa fa-circle-o"></i>正常</a>
            <div class="clear"></div>
        </div>
        <div class="pag-sigtest-item">
            <p class="pag-sigtest-title">低墨量檢查</p>
            <a onclick="send('ink_low_error', 'rbt');" class="pink_btn pag-sigtest-errorBtn"><i class="fa fa-times"></i>異常</a>            
            <a onclick="send('ink_low_ok', 'rbt');" class="pink_btn pag-sigtest-okBtn"><i class="fa fa-circle-o"></i>正常</a>
            <div class="clear"></div>
        </div>                                               
        </main>
    </div>
      <div class="pag pag-init-check">
        <main>
            <ul class="init-check-steps">
                <li class="init-check-on"><i class="fa fa-check-circle-o"></i>連線測試</li><!--init-check-on-->
                <li><i class="fa fa-check-circle-o"></i>相機狀態測試</li>
                <li><i class="fa fa-check-circle-o"></i>機械狀態測試</li>
                <li><i class="fa fa-check-circle-o"></i>使用者位移測試</li>
                <li><i class="fa fa-check-circle-o"></i>使用者中斷測試</li>
                <li><i class="fa fa-check-circle-o"></i>色閘異常測試</li>
                <li><i class="fa fa-check-circle-o"></i>低墨量檢測</li>
            </ul>
            <div><a onclick="" class="pink_btn">完成<i class="fa fa-angle-right"></i></a></div>
        </main>
    </div>  
    <div class="pag pag-settings">
        <main>
		<!-- settings -->
		<ul class="settings_list">
			<li onclick="show_page('.pag-config');">帳號設置</li>
			<li onclick="show_page('.pag-socket-setup');">連線設定</li>
			<li onclick="show_page('.pag-chk-inks');">色閘更換</li>
			<li onclick="show_page('.pag-makeup')">上妝程序</li>
			<li onclick="show_page('.pag-makeup-complete')">化妝完成</li>
			<li onclick="show_page('.pag-about');">基本資訊</li>
			<li onclick="show_page('.pag-notice');">訊息通知</li>
			<li onclick="show_page('.pag-manual');">服務資訊</li>
			<li onclick="show_page('.pag-contact');">意見反饋</li>
			<li onclick="show_page('.pag-sigtest');">測試訊號</li>
			<li onclick="show_points();">顯示特徵點</li>
			<li onclick="logout();">登出</li>
		</ul>
        </main>
    </div>      
    <div id="alert-modal" class="modal">
        <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <button type="button" class="close" onclick="hide_modal()">
                    <i class="fa fa-times"></i>
                </button>
                <h4 class="modal-title" id="alert-title"></h4>
              </div>
              <div class="modal-body">
                <div id="alert-content"></div>
              </div>
              <div class="modal-footer">
                    <a class="btn btn-primary" id="btn-close-alert" onclick="hide_modal();">確定</a>
              </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
    <!-- header -->
    <header>
        <div class="app_nav"><i id="nav-btn-back" class="fa fa-angle-left"></i><span>GLORY</span><!--<i class="fa fa-bars"></i>--></div>
    </header>
    <!-- user_settings -->
    <div class="user_settings_list">
        <main>
            <div class="user_setting_title"><i class="fa fa-chevron-left"></i><span></span></div>
            <form action="" method="post" id="user_settings_form">
                <input type="text" name="stylename" placeholder="" />
                <a onclick="show_page('.pag-about')" class="pink_btn">SAVE<i class="fa fa-angle-right"></i></a>
            </form>
        </main>
    </div>
    <div class="overlap pink_bg">
        <div class="overlap-content">
            <div class="overlap-spin"><i class="fa fa-circle-o-notch fa-spin"></i></div>
            <div class="overlap-msg">正在嘗試連線到主機...</div>
        </div>
    </div>
    <!-- quick_makeup_list -->
    <div class="quick_makeup_list">
        <div class="quick_makeup_search" ><input type="text" name="search" placeholder="全部儲存的樣式" /><i class="fa fa-search"></i></div>
        <ul class="style-list">
            <!--<li><i class="fa fa-circle"></i>MAKEUP STYLE 1</li>-->
        </ul>
    </div>
    <audio id="audio" src="voice/001.m4a" type="audio/mp4"></audio>
    <script type="text/javascript">
            var index_swiper, makeup_style_swiper, makeup_editor_swiper;
            var conn_count=0;
            var mdb = {"glory":{loginid:'glory', passwd:'glory'}};
            var conn_info = {};
            var app_mode = 'control';
            var minfo = {loginid:'glory', passwd:'glory'};
            //var host = location.protocol+'//'+location.hostname+(location.port ? ':'+location.port: '');
            var host = "glory.cloud-us.com";
            var serverhost = "http://glory.cloud-us.com";
            var data = "-- data to be sent --";
            var port = 3000;
            var key = "";
            var proc = "";
            var stat = "";
            var pic_load="N";
            var pic_url="";
            var photo_canvas; //用來裝載#img-face的canvas的getContext('2d')
            var ctrack; //clm用的元件
            var cur_page="";
            var cur_show_page = "";
            var previous_page = "";
            var personal_styles = [];
            var makeup_style=1;
            var socket;
            var mask_w = 230;
            var mask_h = 320;
            var screen_w = 320;
            var screen_h = 640;
            var center_x = 160;
            var center_y = 160;
            var locations = {};
            var socket_connected = false;
            var socket_retry = 0;
            var skip_connected = false;
            var msg1="系統正在讀取您前次的拍攝記錄，請稍候。";
            var msg2="請將您的頭臉按照說明書指示，就正確的位置後，系統會自動進行拍照";
            var msg3="系統無法讀取您前次拍攝記錄，請重新拍攝。";
            var swiper_html = "";
            var rep_action;
            var glory_url = "http://glory.cloud-us.com";
            var ts;
            var colors = {"103":"#c59271", "104":"#c59971", "105":"#c5a071", "106":"#c5a771", "107":"#c5ae71", "201":"#c6927e", "202":"#e59bdc", "312":"#ff9d7b", "316":"#ff9d6e", "322":"#bf9474", "330":"#1e1a34", "315":"#c5cfda", "327":"#0067a0", "328":"#1d252d", "401":"#fabbcb", "402":"#ffa38b" };
            $(function(){
                $('#host').val(host);
                $('#port').val(port);
                screen_w = $(window).width();
                screen_h = $(window).height();
                center_x = parseInt(screen_w/2);
                show_page('.pag-init');
            });
            function show_page(target_page){
                previous_page = cur_page;
                if(!target_page) target_page = cur_page;
                if(target_page != '.pag-msg') cur_page = target_page;
                toggle_slide_menu(true);
                $('.pag').hide();
                $('.modal').hide(); 
                $(target_page).show();
                cur_show_page = target_page;
                if($(target_page).hasClass('no-header')){
                    $('header').animate({'top':'-36px'});
                }else{
                    $('header').animate({'top':'0px'});
                }
                // if($('.settings_list').hasClass('in')) $('#nav-btn-list').trigger('click');
                init_page(target_page);
            }
            function prev_page(){
                if(!previous_page) previous_page = '.pag-index';
                show_page(previous_page);
            }
            function init_page(target_page){
                $('.app_nav').show();
                if(target_page == '.pag-init'){
                    var to_page = '.pag-login';
                    if(Cookies.get('mdb')){
                        mdb = Cookies.getJSON('mdb');
                    }
                    if(Cookies.get('minfo')){
                        minfo = Cookies.getJSON('minfo');
                        to_page = '.pag-index';
                        load_saved_styles();
                    }else if(minfo){
                        //to_page = '.pag-index';
                    }
                    if(Cookies.get('conn_info')){
                        conn_info = Cookies.getJSON('conn_info');
                        host = conn_info.host;
                        port = conn_info.port;
                        console.log('host=' + host + ', port = ' + port);
                    }else{
                        proc_socket_error();
                        return false;
                    }
                    $('#Welcome_page').click(function(){
                        show_page(to_page);
                    });
                }else if(target_page == '.pag-login' || target_page == '.pag-register'){
                    $('.app_nav').hide();
                }else if(target_page == '.pag-index'){
                    $('#camera-btn1').show();
                    if(!index_swiper) index_swiper = new Swiper('#index_sliders', {
                        pagination: '.swiper-pagination',
                        paginationClickable: true,
                        loop: true
                    });
                    connect();
                }else if(target_page == '.pag-socket-setup'){
                    app_mode = 'fun';
                }else if(target_page == '.pag-config'){
                    $('#cfg_name').val(minfo.name);
                    $('#cfg_email').val(minfo.email);
                    $('#cfg_loginid').val(minfo.loginid);
                    $('#cfg_passwd').val(minfo.passwd);    
                }else if(target_page == '.pag-camera'){
                    startProc('prepare_face');
                }else if(target_page == '.pag-picture'){ 
                    //重新計算big_face_circle的margin-top
                    var margin_top = (screen_h - 511) /2;
                    $('.big_face_circle').css({'margin-top':margin_top});
                    $('.big_circle_bg').css({'margin-top':margin_top-26});
                    //取得上次拍照內容
                    load_picture();
                    center_x = 160;
                    center_y = 160;
                    if(!makeup_style_swiper){
                        makeup_style_swiper = new Swiper ('.makeup_styles', {
                            slidesPerView: 3
                        });
                    }
                    //將編輯區域的色塊著色
                    $.each(colors, function(k,v){
                        $('.c'+k).css({'background-color':v});
                    });
                }else if(target_page == '.pag-chk-inks'){
                    if(app_mode == 'control'){
                        check_ink();
                    }else{
                        msgbox_show('離線模式','APP目前設定為離線模式，在本模式下您無法操作化妝機進行化妝。是否現在設定連線？',[
                            {text:"設定連線",click:function(){show_page('.pag-socket-setup')}},
                            {text:"取消",click:function(){hide_modal();}}
                            ]);
                    }
                }else if(target_page == '.pag-makeup'){
                    startProc('select_style');
                }else if(target_page == '.pag-init-check'){
                    //init-check-on
                    rep_action = function(data){
                        if(data.substring(0,4) == 'fake'){
                            var fake_step = parseInt(data.substring(4,5));
                            $('.init-check-steps li').eq(fake_step).addClass('init-check-on');
                        }
                    };
                    send('init_check');
                }
            }
            function confirm_offline_mode(){

            }
            function proc_socket_error(){
                $('.overlap').hide();
                if(app_mode == 'fun'){
                    if(socket) socket.close();
                    return;
                }
                if(socket_retry > 5){
                    if(socket) socket.close();
                    app_mode = 'fun';
                    confirm_offline_mode();
                    return;
                }
                socket_retry++;
                if($(cur_page).hasClass('ignore-socket-err')) return;
                if(conn_info.host){
                    show_page('.pag-socket-error');
                }else{
                    show_page('.pag-chk-connect');
                }
            }

            function connect(afterconn){
                if(socket_connected) return;
                if(socket){
                    socket.io.disconnect();
                    socket.close();
                }
                try{
                    var conn_url = 'http://'+ host + ':' + port;
                    console.log('try to conn '+ conn_url);
                    socket = io.connect(conn_url );
                    setTimeout(function(){
                        if(!socket_connected){
                            proc_socket_error();
                        }
                    },3000);
                    
                    socket.on('connect', function() {
                        $('.overlap').hide();
                        console.log('connected to ' + conn_url);
                        socket_connected = true;
                        socket.on('cmd', function (data) {
                            data = data.toString().trim();
                            console.log('rec from socket io : '+data);
                            handelProc(data);
                        });
                        socket.on('msg', function (data) {
                            console.log('msg from socket io : '+data);
                            msgpage_show('系統訊息', data);
                        });
                        socket.on('rep', function (data) {
                            console.log('rep from socket io : '+data);
                            if(rep_action){
                                rep_action(data);
                            }else{
                                msgbox_show('系統訊息', data);
                            }
                        });
                        socket.on('disconnect', function(){
                            socket_connected = false;
                            proc_socket_error();
                        });
                        app_mode = 'control';
                        if(afterconn) afterconn();
                    });
                    socket.on('connect_timeout',function(){
                        socket_connected = false;
                        proc_socket_error();
                    });
                    socket.on('connect_failed', function() {
                        socket_connected = false;
                        proc_socket_error();
                    });
                    socket.on('error', function() {
                        socket_connected = false;
                        proc_socket_error();
                    });
                    socket.io.on('connect_error', function(err) {
                        socket_connected = false;
                        proc_socket_error();
                    });
                    //setTimeout(function(){ show_page(to_page) }, 500);
                }catch(e){
                    msgbox_show('連線錯誤', '系統發生未預期的錯誤，請嘗試更新您的設定。', [{
                        text:"確定", click:function(){
                        show_page('.pag-setup');
                    } }]);
                    console.log('socket error=' + e);
                    return false;
                }
            }
            function reconnect(){
                socket_retry=0;
                host = $('#host').val();
                port = $('#port').val();
                conn_info.host = host;
                conn_info.port = port;
                Cookies.set('conn_info', conn_info, { expires: 365 });
                app_mode = 'control';
                var afterconn =function(){
                    msgbox_show('連線成功', 'APP已成功連接化妝機，您現在可以操作化妝功能！', 
                    [{text:'返回首頁', click: function(){ show_page('.pag-index');}}]);
                };
                $('.pag-socket-setup').removeClass('ignore-socket-err');
                $('.overlap-msg').html('正在嘗試連線到主機...');
                $('.overlap').show();
                connect(afterconn);
            }
            function draw_face(snum,new_colorsn_a,new_colorsn_b,new_colorsn_c){
                //var cur_host = 'http://' + host + '/images/simulate/';
                makeup_style = snum;
                var cur_host = 'img/';
                var colorsn_a = $('.eyeshadow_editors #area_circle_A').attr('colorsn');
                var colorsn_b = $('.eyeshadow_editors #area_circle_B').attr('colorsn');
                var colorsn_c = $('.eyeshadow_editors #area_circle_C').attr('colorsn');
                if(new_colorsn_a){
                	colorsn_a = new_colorsn_a;
                }else if(new_colorsn_b){
                	colorsn_b = new_colorsn_b;
                }else if(new_colorsn_c){
                	colorsn_c = new_colorsn_c;
                }
                brush_left = cur_host+ 'brush_left'+snum+'.png?r='+get_random_str();
                brush_right = cur_host+ 'brush_right'+snum+'.png?r='+get_random_str();
                //原本的單圖眼影
                // eye_left = cur_host+ 'eye_left'+snum+'.png?r='+get_random_str();
                // eye_right = cur_host+ 'eye_right'+snum+'.png?r='+get_random_str();
                //分成三區的左眼影
                eye_left_a = cur_host+ 'eye_left_a_'+colorsn_a+'.png?r='+get_random_str();
                eye_left_b = cur_host+ 'eye_left_b_'+colorsn_b+'.png?r='+get_random_str();
                eye_left_c = cur_host+ 'eye_left_c_'+colorsn_c+'.png?r='+get_random_str();
                //分成三區的右眼影
                eye_right_a = cur_host+ 'eye_right_a_'+colorsn_a+'.png?r='+get_random_str();
                eye_right_b = cur_host+ 'eye_right_b_'+colorsn_b+'.png?r='+get_random_str();
                eye_right_c = cur_host+ 'eye_right_c_'+colorsn_c+'.png?r='+get_random_str();                            
                //var loc = get_draw_locs();
                var brush_loc = cal_brush_loc();
                var eye_loc = cal_eye_loc();
                //console.log(brush_loc);
                $('#makeup_canvas').clearCanvas()
                .drawImage({
                    source: brush_left,
                    x: brush_loc.blx, y: brush_loc.bly,
                    scale: brush_loc.blr,
                    rotate: brush_loc.bln,
                    opacity: 0.6,
                    layer: true,
                    fromCenter: true,
                    groups: ['makeups'],
                    name: 'brushleft'
                })
                .drawImage({
                    source: brush_right,
                    x: brush_loc.brx, y: brush_loc.bry,
                    scale: brush_loc.brr,
                    rotate: brush_loc.brn,
                    opacity: 0.6,
                    layer: true,
                    fromCenter: true,
                    groups: ['makeups'],
                    name: 'brushright'
                })
                //左眼影分三區上妝
                .drawImage({
                    source: eye_left_a,
                    x: eye_loc.elx, y: eye_loc.ely,
                    scale: 0.6,
                    opacity: 0.7,
                    layer: true,
                    fromCenter: true,
                    groups: ['makeups'],
                    name: 'eyeleft_a'
                })
                .drawImage({
                    source: eye_left_b,
                    x: eye_loc.elx, y: eye_loc.ely,
                    scale: 0.6,
                    opacity: 0.7,
                    layer: true,
                    fromCenter: true,
                    groups: ['makeups'],
                    name: 'eyeleft_b'
                })
                .drawImage({
                    source: eye_left_c,
                    x: eye_loc.elx, y: eye_loc.ely,
                    scale: 0.6,
                    opacity: 0.7,
                    layer: true,
                    fromCenter: true,
                    groups: ['makeups'],
                    name: 'eyeleft_c'
                })
                //右眼影分三區上妝
                .drawImage({
                    source: eye_right_a,
                    x: eye_loc.erx, y: eye_loc.ery,
                    scale: 0.6,
                    opacity: 0.7,
                    layer: true,
                    fromCenter: true,
                    groups: ['makeups'],
                    name: 'eyeright_a'
                })
                .drawImage({
                    source: eye_right_b,
                    x: eye_loc.erx, y: eye_loc.ery,
                    scale: 0.6,
                    opacity: 0.7,
                    layer: true,
                    fromCenter: true,
                    groups: ['makeups'],
                    name: 'eyeright_b'
                })
                .drawImage({
                    source: eye_right_c,
                    x: eye_loc.erx, y: eye_loc.ery,
                    scale: 0.6,
                    opacity: 0.7,
                    layer: true,
                    fromCenter: true,
                    groups: ['makeups'],
                    name: 'eyeright_c'
                });                                              
            }
            function handle_no_pic(){
                if(pic_load == "N"){
                    pic_load = "X";
                    $('#photo-msg-text').html(msg3);
                    $('#camera-btn1').html('拍攝照片').show();
                    $('#camera-btn2').hide();
                    $('.photo-msg-loader').css('opacity',0);
                }
            }
            function sig_test(str){
                rep_action = function(data){
                    msgpage_show('訊號測試結果', data)
                }
                send(str);
            }
            function send(str, typ) {
                if(!typ) typ = 'cmd';
                if(socket_connected){
                    socket.emit(typ, str);
                }else if(conn_info.host){
                    show_page('.pag-socket-error');
                }else{
                    show_page('.pag-chk-connect');
                }
            }
            function startProc(cmd){
                $('#msg-code').html(cmd);
                if(cmd == 'prepare_face'){
                    document.getElementById('audio').setAttribute("src", "voice/001.m4a");
                    document.getElementById('audio').play();
                    document.getElementById('audio').addEventListener("ended", start_prepare_pic);
                }else if(cmd == 'prepare_pic'){
                    $('#msg-code').html('enter prepare_pic');
                    document.getElementById('audio').setAttribute("src", "voice/002.m4a");
                    document.getElementById('audio').play();
                    document.getElementById('audio').addEventListener("ended", start_get_pic);
                    $('#msg-code').html('finish prepare_pic');
                }else if(cmd == 'makeup_complete'){
                    document.getElementById('audio').setAttribute("src", "voice/006.m4a");
                    document.getElementById('audio').play();
                    document.getElementById('audio').addEventListener("ended", end_makeup_complete);
                    $('#emerg-btn').hide();
                    $('#back-index').show();
                }else if(cmd == 'finish_process'){
                    $('#steps-msg').html('化妝程序完成。');
                }else if(cmd == 'stop_camera'){
                    document.getElementById('audio').pause();
                    document.getElementById('audio').currentTime = 0;
                    show_page('.pag-index');
                }
                if(socket_connected){
                    if(cmd == 'get_pic'){
                        document.getElementById('audio').play();
                        proc = "wait for pic";
                        send("get_pic");
                    }else if(cmd == 'select_style'){
                        proc = "wait for makeup";
                        send("select_type=" + makeup_style);
                    }else if(cmd == 'stop_makeup'){
                        proc = "stop makeup";
                        send("stop_makeup");
                        show_page('.pag-stop-makeup');
                        document.getElementById('audio').pause();
                    }
                }else{
                    if(cmd == 'get_pic'){
                        document.getElementById('audio').setAttribute("src", "voice/003.m4a");
                        document.getElementById('audio').play();
                        document.getElementById('audio').addEventListener("ended", end_get_pic);
                    }else if(cmd == 'select_style'){
                        document.getElementById('audio').setAttribute("src", "voice/005.m4a");
                        document.getElementById('audio').play();
                        document.getElementById('audio').addEventListener("ended", end_make_up);
                    }else if(cmd == 'stop_makeup'){
                        show_page('.pag-stop-makeup');
                        document.getElementById('audio').pause();
                    }
                }
            }
            function start_prepare_pic(){
                document.getElementById('audio').setAttribute("src", "");
                document.getElementById('audio').removeEventListener("ended", start_prepare_pic);
                countdown(3, '#pag-camera-msg', "prepare_pic" );
            }
            function start_get_pic(){
                $('#camera-btn1').hide();
                document.getElementById('audio').setAttribute("src", "");
                document.getElementById('audio').removeEventListener("ended", start_prepare_pic);
                document.getElementById('audio').removeEventListener("ended", start_get_pic);
                countdown(3, '#pag-camera-msg', "get_pic" );
            }
            function end_get_pic(){
                document.getElementById('audio').removeEventListener("ended", end_get_pic);
                handelProc('get_pic_ok');
            }
            function end_make_up(){
                document.getElementById('audio').removeEventListener("ended", end_make_up);
                countdown(3, '#steps-msg', "makeup_complete" );
            }
            function end_makeup_complete(){
                document.getElementById('audio').removeEventListener("ended", end_makeup_complete);
                countdown(3, '#steps-msg', "finish_process" );
            }
            function countdown(s, ele, func){
                var f = function(){
                    $(ele).text(s);
                    s--;
                    if(s > 0){
                        setTimeout(f, 1000);
                    }else{
                        $(ele).text('');
                        startProc(func);
                    }
                };
                f();
            }
            /* 當#photo_canvas的 canvas物件尚未init時，在此處init */
            function load_picture(fid){
                //
                if(!pic_url) pic_url = 'http://' + host + ':'+ port + '/face.bmp?r='+get_random_str(); 
                if(!socket_connected) pic_url = pic_url = 'http://' + host + '/face.bmp?r='+get_random_str();
                //alert(pic_url);
                if(!photo_canvas) photo_canvas = document.getElementById('photo_canvas').getContext('2d');
                var img = new Image();
                img.setAttribute('crossOrigin', '');
                //img.crossOrigin = 'anonymous';
                img.onload = function() {
                    photo_canvas.drawImage(img,160, 0, 320, 320, 0, 0, 320, 320);
                    //TODO:ctrack 開始運作後，應該要有一個 loading 的過程，待clmtrackrConverged完成時去掉～
                    ctrack.start(document.getElementById('photo_canvas'));
                };
                img.src = pic_url;
                $('#photo_img').attr('src', pic_url);
            }
            /*  */
            function handelProc(rcv){
                if(rcv.substring(0, 10) == 'get_pic_ok'){
                    //讀取圖片
                    pic_url = 'http://' + host + ':'+ port + '/face.bmp?r='+get_random_str();                    
                    show_page('.pag-picture');
                    document.getElementById('audio').setAttribute("src", "voice/004.m4a");
                    document.getElementById('audio').play();
                    return;
                }else if(rcv.substring(0, 4) == 'step'){
                    if(cur_page != '.pag-makeup-step') show_page('.pag-makeup-step');
                    var step = rcv.substring(4, 5);
                    $('#cur_step').html(step);
                }else if(rcv.substring(0, 15) == 'makeup_complete'){
                    show_page('.pag-makeup-complete');
                }
            }
            function backToStart(){
                $('.socket-data').show();
                $('.sho-pic, .steps').hide();
            }
            function get_random_str(){
                var s = Math.floor((Math.random() * 10000) + 1);
                return s.toString();
            }
            function draw_landmarks(pos){
                var targetarray = ['p0','p4','p35', 'p14', 'p39','p10', 'p21','p23', 'p24','p25','p17', 'p28','p29', 'p30'];
                var cls, ctxt;
                $.each(locations, function(k, v){
                    cls = '';
                    ctxt = '';
                    if(targetarray.indexOf(k) >= 0){
                        cls = 'bigp';
                        //ctxt = k;
                    }
                    draw_point(k, v, cls, ctxt);
                });
            }
            function draw_point(k, v, cls, ctxt){
                var p = '<div class="lmp '+cls+'" id="'+k+'">'+ctxt+'</div>';
                var pobj = $(p);
                pobj.appendTo('.sho-points').css({'position':'absolute', 'top':v.y+'px', 'left':v.x+'px'});
            }
            function choose_style(sn){
                var sel = '.makeup_style_' + sn;
                $(sel).parent().find('.makeup_style_options.on').removeClass('on');
                $(sel).parent().find('.fa-check').hide();
                $(sel).children('.fa-check').show();
                $(sel).parent().find('.makeup_style_options').css("opacity", "1");
                $(sel).css("opacity", "0.5").addClass('on');
                $(sel).parents('.makeup_style_lists').find('.makeup_style_funcs').addClass('is_selected');
                //讀出該選項的JSON
                var target_url = serverhost + "/do.php?cmd=get_style_info";
                /*
                get_data(target_url, {sn: sn}, function(res){
                    var content = res.data.content;
                    apply_style(content);
                });
                */
                $.get( "style_info.txt", function( ret ) {
                    var data = $.parseJSON(ret);
                    if(data['style_' + sn]){
                        var content = data['style_' + sn].content;
                        apply_style(content);
                        draw_face(sn);
                    }
                });
            }
            function apply_style(content){
                //先處理 foundation color
                var colorsn = content.foundation.color;
                $('.fundation_style_list .footer_list[colorsn="'+colorsn+'"]').trigger('click');
                //其次：腮紅,眼影的style
                $('.blush_style_list .footer_list[sn="'+content.blush.style+'"]').trigger('click');
                $('.eye_style_list .footer_list[sn="'+content.eyeshadow.style+'"]').trigger('click');
                //其次：腮紅,眼影的design的color
                if(content.blush.area_A) $('.blush_editors #area_circle_A').css({'background-color':colors[content.blush.area_A.color]}).attr('colorsn',content.blush.area_A.color);
                if(content.blush.area_B) $('.blush_editors #area_circle_B').css({'background-color':colors[content.blush.area_B.color]}).attr('colorsn',content.blush.area_B.color);
                if(content.eyeshadow.area_A) $('.eyeshadow_editors #area_circle_A').css({'background-color':colors[content.eyeshadow.area_A.color]}).attr('colorsn',content.eyeshadow.area_A.color);
                if(content.eyeshadow.area_B) $('.eyeshadow_editors #area_circle_B').css({'background-color':colors[content.eyeshadow.area_B.color]}).attr('colorsn',content.eyeshadow.area_B.color);
                if(content.eyeshadow.area_C) $('.eyeshadow_editors #area_circle_C').css({'background-color':colors[content.eyeshadow.area_C.color]}).attr('colorsn',content.eyeshadow.area_C.color);
            }
            //腮紅位置計算
            function cal_brush_loc(){
                var pla = locations['p0'];//右耳上
                var plb = locations['p35'];//右鼻翼外側
                var plc = locations['p4'];//右下頰
                var pra = locations['p14'];//左耳上
                var prb = locations['p39'];//左鼻翼外側
                var prc = locations['p10'];//左下頰
                var loc = {};
                loc.bld = (plb.x - pla.x) ;
                var blxo = loc.bld / 8; //左側的腮紅中心位移計算
                loc.blx = (pla.x + plb.x) / 2 - blxo; 
                loc.bly = (pla.y + plb.y) / 2 + 15;
                loc.blr = loc.bld / 80; // 左側的腮紅縮放計算
                loc.bln = (plc.x - pla.x) / ( plb.x - pla.x) * 15; //左側腮紅旋轉角度計算(負值就逆旋轉)
                draw_point('bl', {x:loc.blx, y:loc.bly}, 'bigp', 'BL');

                loc.brd = (pra.x - prb.x) ;
                var brxo = loc.bld / 8; //左側的腮紅圓心位移計算
                loc.brx = (pra.x + prb.x) / 2 + brxo;
                loc.bry = (pra.y + prb.y) / 2 + 15;
                loc.brr = loc.brd / 80; // 右側的腮紅縮放計算
                loc.brn = (prc.x - pra.x) / ( prb.x - pra.x) * -15; //右側腮紅旋轉角度計算(正值就逆旋轉)
                draw_point('br', {x:loc.brx, y:loc.bry}, 'bigp', 'BR');
                return loc;
            }
            //眼影位置計算
            function cal_eye_loc(){
                var ple4 = locations['p21'];//右眉下中
                var ple5 = locations['p23'];//右眼外側
                var ple6 = locations['p25'];//右眼內側
                var ple7 = locations['p24'];//右眼上中

                var pre4 = locations['p17'];//左眉下中
                var pre5 = locations['p30'];//左眼內側
                var pre6 = locations['p28'];//左眼外側
                var pre7 = locations['p29'];//左眼上中
                var loc = {};
                loc.elxd = ple6.x - ple5.x; //右眼區寬度
                loc.elyd = ple7.y - ple4.y; //右眼區高度
                loc.elx = ple7.x - loc.elxd / 5;
                loc.ely = (ple7.y + ple4.y) / 2 + loc.elyd / 3;
                loc.erxd = pre6.x - pre5.x //左眼寬度
                loc.eryd = pre7.y - pre4.y; //右眼區高度
                loc.erx = pre7.x + loc.erxd / 5;
                loc.ery = (pre7.y + pre4.y) / 2 + loc.eryd / 3;
                return loc;
            }
            function get_text(furl, postdata, proc_handler){
                $.ajax({
                    method: "POST",
                    url: furl,
                    data: postdata,
                }).done(function( res ) {
                    if(typeof(proc_handler) === 'function') proc_handler(res);
                });
            }
            function msgbox_show(title, content, buttons){
                $('.btn-newadd').remove();
                $('#btn-close-alert').show();
                $('#alert-title').html(title);
                $('#alert-content').html(content);
                show_modal('#alert-modal');
                if(buttons && Array.isArray(buttons)){
                    $('#btn-close-alert').hide();
                    $.each(buttons, function(k,v){
                        var btn = '<a class="btn btn-primary btn-newadd" >'+v.text+'</a>';
                        $(btn).click(v.click).appendTo('.modal-footer');
                    });
                }else if(buttons == 'START MAKEUP'){
                    $('#btn-close-alert').html('START MAKEUP').attr("onclick","check_ink()");
                    $('.modal-dialog').css({'top':'150px'});
                    $('.modal-body').css({'overflow-y':'auto','height':'auto'});
                }else if(buttons == 'RELOAD'){
                    $('#btn-close-alert').html('RELOAD').attr("onclick","check_ink()").click(function(){
                        $('#alert-modal').slideToggle();
                    });
                    $('.modal-dialog').css({'top':'50px'});
                    $('.modal-body').css({'overflow-y':'scroll','height':'50vh'});
                }
            }
            function show_modal(objid){
                $(objid).removeClass('modal-open').removeClass('in').addClass('modal-open').addClass('in').show();
            }
            function hide_modal(){
                $('.modal').hide();
            }
            function msgpage_show(title, data){
                $('#pag-msg-title').html(title);
                $('#pag-msg-content').html(data);
                if(cur_show_page != '.pag-msg') show_page('.pag-msg');
            }
            function data_receiver(cmd){
                if(cmd.substring(0,10) == 'get_pic_ok'){
                    alert('start relaod picture');
                    show_page('.pag-camera');
                }
            }
            function show_color_plate(){
                
            }
            function change_color(cstyle, step, cnum, classname){
                var newclass = classname.replace("color-choose-btn ", "");
                $('.pag-picture .swiper-slide[cstyle="'+cstyle+'"]').find('li[cnum="'+cnum+'"]').removeClass().addClass(newclass);
                $('.color-plate').hide();
            }
            function show_list() {
                var selected = $('#slidemenu').hasClass('slide-active');
                toggle_slide_menu(selected);
            }
            function choose_color(obj){

                change_color(cstyle, step, cnum, classname);
            }
            function set_mode(mode){
                if(mode == 'fun'){
                     msgbox_show('離線模式', '您將切換到離線模式，在本模式下您無法操作化妝機進行化妝。是否確定？', 
                    [
                        {text:'確定', click: function(){ app_mode = mode; show_page('.pag-index');}}, 
                        {text:'取消',click:function(){ hide_modal();}}
                    ]);
                }else{
                    app_mode = mode;
                    show_page('.pag-index');
                }
            }
            function show_forget(targetobj){

                if(targetobj == 'loginid'){
                    $('.forgot_username_block').slideToggle();
                    $('.forgot_password_block').hide();
                }else{
                    $('.forgot_password_block').slideToggle();
                    $('.forgot_username_block').hide();
                }
            }
            function send_forget(targetobj){
                if(targetobj == 'loginid'){
                    $('.forgot_username_block').slideToggle();
                }else{
                    $('.forgot_password_block').slideToggle();
                }
            }
            function login(){
                var loginid = $('#loginid').val();
                var passwd = $('#passwd').val();
                if(!loginid || !passwd){
                    msgbox_show('缺少必填的資料', '請輸入帳號及密碼後，再按下「登入」按鈕，謝謝！');
                    return false;
                }
                if(mdb[loginid]){
                    if(mdb[loginid].passwd != passwd){
                        msgbox_show('登入失敗', '您輸入的帳號不存在，請檢查是否正確輸入後再試一次。');
                        return false;
                    }else{
                        minfo = mdb[loginid];
                        Cookies.set('minfo', minfo, { expires: 365 });
                        load_saved_styles();
                        show_page('.pag-index');
                    }
                }else{
                    msgbox_show('登入失敗', '您輸入的帳號不存在，請檢查是否正確輸入後再試一次。');
                    return false;
                }
                /*
                get_data("do.php?cmd=login", {loginid:loginid, passwd:passwd}, function(res){
                    if(res.minfo){
                        Cookies.set('minfo', res.minfo, { expires: 365 });
                        show_page('.pag-index');
                    } 
                });
                */
            }
            function register(){
                var loginid = $('#reg_loginid').val();
                var passwd = $('#reg_passwd').val();
                var passwd_chk = $('#reg_passwd_chk').val();
                if(!loginid || !passwd ){
                    msgbox_show('缺少必填的資料', '請在輸入完整資料後，再按下「送出」按鈕，謝謝！');
                    return false;
                }else if(passwd != passwd_chk){
                    msgbox_show('密碼不符', '您輸入的密碼和確認密碼不相符合！');
                    return false;
                }
                if(mdb[loginid]){
                    msgbox_show('註冊失敗', '您要使用的帳號已經存在，請更換帳號後再試一次。');
                    return false;
                }
                minfo = {loginid:loginid, passwd:passwd};
                mdb[loginid] = minfo;
                Cookies.set('minfo', minfo, { expires: 365 });
                msgbox_show('註冊成功', '感謝您註冊，請填寫下列基本資料以便未來提供您更多的服務。', [{'text':'確定',click:function(){
                        $('.register_block').hide();
                        $('.edit_member_block').show();
                    }}]);
                /*
                get_data(glory_url + "/do.php?cmd=register", {loginid:loginid, passwd:passwd, name:name, email:email}, function(res){
                    if(res.minfo){
                        Cookies.set('minfo', res.minfo, { expires: 365 });
                        show_page('.pag-index');
                    } 
                });*/
            }
            function edit_member(src){
                var upd = {};
                if(src == 'register'){
                    upd.name = $('#reg_name').val();
                    upd.email = $('#reg_email').val();
                    upd.mobile = $('#reg_mobile').val();
                }else{
                    upd.loginid = $('#cfg_loginid').val();
                    upd.passwd = $('#cfg_passwd').val();
                    upd.name = $('#cfg_name').val();
                    upd.email = $('#cfg_email').val();
                    upd.mobile = $('#cfg_mobile').val();
                }
                $.each(upd, function(k,v){
                    if(v.length > 0){
                        minfo[k] = v;
                    }
                });
                Cookies.set('minfo', minfo, { expires: 365 });
                
                if(src== "register"){
                    //更新mdb
                    mdb[upd.loginid] = {loginid:upd.loginid, passwd:upd.passwd};
                    show_page('.pag-index');
                }
            }
            function logout(){
                minfo = {};
                Cookies.remove('minfo');
                Cookies.remove('conn_info');
                show_page('.pag-login');
            }
            function toggle_slide_menu(selected){
                $('#slidemenu').stop().animate({
                    left: selected ? '-210px' : '0px'
                });
                $('#navbar-height-col').stop().animate({
                    left: selected ? '-210px' : '0px'
                });
                $('.pag:visible').stop().animate({
                    left: selected ? '0px' : '210px'
                });
                $(this).toggleClass('slide-active', !selected);
                $('#slidemenu').toggleClass('slide-active');
                $('.pag:visible, .navbar, body, .navbar-header').toggleClass('slide-active');
            }
            function get_style_settings(){
                var foundation_color = $('.fundation_style_list .footer_list.on').attr('colorsn');
                var blush_color_A = $('.blush_editors #area_circle_A').attr('colorsn');
                var blush_color_B = $('.blush_editors #area_circle_B').attr('colorsn');
                var eye_color_A = $('.eyeshadow_editors #area_circle_A').attr('colorsn');
                var eye_color_B = $('.eyeshadow_editors #area_circle_B').attr('colorsn');
                var eye_color_C = $('.eyeshadow_editors #area_circle_C').attr('colorsn');
                var blush_style = $('.blush_style_list .footer_list.on').attr('sn');
                var eye_style = $('.eye_style_list .footer_list.on').attr('sn');
                var data = {"foundation": {"color": "103"},"blush": {"style": "2","area_A": {"color": "202","size": "1","pos": "0,0"},"area_B": {"color": "312","size": "1","pos": "0,0"}},"eyeshadow": {"style": "3","area_A": {"color": "315","size": "1","pos": "0,0"}, "area_B":{"color": "327","size": "1","pos": "0,0"}, "area_C":{"color": "328","size": "1","pos": "0,0"}}};
                if(foundation_color ) data.foundation.color = foundation_color;
                if(blush_color_A ) data.blush.area_A.color = blush_color_A;
                if(blush_color_B ) data.blush.area_B.color = blush_color_B;
                if(eye_color_A ) data.eyeshadow.area_A.color = eye_color_A;
                if(eye_color_B ) data.eyeshadow.area_B.color = eye_color_B;
                if(eye_color_C ) data.eyeshadow.area_C.color = eye_color_C;
                if(blush_style) data.blush.style=blush_style;
                if(eye_style) data.eyeshadow.style=eye_style;
                return data;
            }
            function save_style(){
                var styleName = $('#new_styleName').val();
                if(styleName.length <= 0 ){
                    msgbox_show('新增樣式錯誤','您尚未輸入化妝樣式名稱，請輸入後再按儲存按鈕，謝謝。');
                    return;
                }
                var target_url = serverhost + "/do.php?cmd=save_personal_styles";
                var new_content = get_style_settings();
                var data = {styleName:styleName, content:new_content };
                /*
                get_data(target_url, {loginid:minfo[loginid], data:data}, function(res){
                    personal_styles.push(new_content); 
                    var html = '<li><i class="fa fa-circle"></i><span>'+styleName+'</span></li>' + "\n"; 
                    $('.style-list').append(html);
                    $('.styleName_save_btn').toggle();
                    $('.styleName_continue_btn').toggle();
                    $('.stylename').hide();
                });
                */
                personal_styles.push(data);
                localStorage.setItem('personal_styles', JSON.stringify(personal_styles));
                var html = '<li><i class="fa fa-circle"></i><span>'+styleName+'</span></li>' + "\n"; 
                $('.style-list').append(html);
                $('.styleName_save_btn').toggle();
                $('.styleName_continue_btn').toggle();
                $('.stylename').hide();
            }
            function save_continue(){
                $('.styleName_save_btn').toggle();
                $('.styleName_continue_btn').toggle();
                $('.stylename').show();
            }
            function load_saved_styles(){
                /*
                var target_url = serverhost + "/do.php?cmd=load_personal_styles";
                get_data(target_url, {loginid:minfo[loginid]}, function(res){
                    $('.style-list').html('');
                    var html = '';
                    $.each(res.data, function(k, v){
                        html += '<li><i class="fa fa-circle"></i><span>'+v.styleName+'</span></li>' + "\n";
                        personal_styles.push(v); 
                    });
                    $('.style-list').html(html);
                });
                */
                //if(localStorage.personal_styles) personal_styles = $.parseJSON(localStorage.personal_styles);
                $('.style-list').html('');
                var html = '';
                $.each(personal_styles, function(k, v){
                    html += '<li><i class="fa fa-circle"></i><span>'+v.styleName+'</span></li>' + "\n";
                });
                $('.style-list').html(html);
            }
            function doShare(){
                window.plugins.share.show(
                    {
                        subject: '我在Glory化妝機APP模擬上妝',
                        text: '我在Glory化妝機APP模擬上妝，快到 http://glory.cloud-us.com/share.php?sid=1312 一起來看我的照片喔！'
                    },
                    function() {}, // Success function
                    function() {alert('Share failed')} // Failure function
                );
            }
            function check_ink(){
                if($('#btn-close-alert').html() == 'START MAKEUP'){
                    show_page('.pag-makeup');
                    return;
                }
                rep_action = function(data){
                    $('.color_check_block').hide();
                    $('.color_detection_block').show();
                    rep_action = null;
                    var inks = data.toString().split(",");
                    $('.sm_circle').removeClass('alert');
                    var nopass = false;
                    var chk_color = [];                    
                    //以下將每一個小圓檢查是否色閘正確，並上色標記墨量，寫上inksn(機器端的色閘編號)
                    $.each(inks, function(n,v){
                        var ink = v.split(":");
                        var inksn = ink[0];
                        var inkvol = 50-parseInt(ink[1]);
                        var alertclass = "";
                        var colorsn = "";
                        switch(n){
                            case 1:
                                colorsn = $('.fundation_style_list .footer_list.on').attr('colorsn');
                            break;
                            case 4:
                                colorsn = $('.blush_editors #area_circle_A').attr('colorsn');
                            break;
                            // case 5:
                            //     colorsn = $('.blush_editors #area_circle_B').attr('colorsn');
                            // break;
                            case 6:
                                colorsn = $('.eyeshadow_editors #area_circle_A').attr('colorsn');
                            break;
                            case 7:
                                colorsn = $('.eyeshadow_editors #area_circle_B').attr('colorsn');
                            break;
                            case 8:
                                colorsn = $('.eyeshadow_editors #area_circle_C').attr('colorsn');
                            break;
                            default:
                                colorsn = inksn;
                            break;
                        }
                        if(colorsn != inksn){
                            alertclass = "alert";
                            nopass = true;
                            chk_color[n] = new Array();
                            chk_color[n].push(inksn,colorsn);
                        }
                        $('.sm_circle_' + n).css({'background-color':colors[inksn]}).addClass(alertclass);
                        $('.sm_circle_' + n + ' .ink_number').html(inksn);
                        $('.sm_circle_' + n + ' .ink_status').css({'height':inkvol});
                    });
                    //以下判斷是否有色閘出錯
                    if(nopass === false){
                        msgbox_show('全部都已經是正確的色閘了','請點選START MAKEUP按鈕開始化妝','START MAKEUP');
                    }else if(nopass === true){
                        msgbox_show('請更換正確的色閘','化妝機目前安裝的色匣有部份不符合本次化妝所指定的顏色。請依照下列的指示更換色匣，完成後請按下畫面的RELOAD按鈕。<div id="chk_color_area"></div>','RELOAD');
                        for (var i = 0 ; i < chk_color.length; i++) {
                            if(chk_color[i] != undefined){
                                // create text
                                var chk_color_i = document.createTextNode(i);
                                var chk_color_inksn = document.createTextNode(chk_color[i][0]);
                                var chk_color_colorsn = document.createTextNode(chk_color[i][1]);

                                // create an element for the text and append it
                                var circle_i = document.createElement('h1');
                                circle_i.appendChild(chk_color_i);


                                var circle_inksn = document.createElement('h2');
                                circle_inksn.appendChild(chk_color_inksn);

                                var arrow = document.createElement('span');

                                var circle_colorsn = document.createElement('h3');
                                circle_colorsn.appendChild(chk_color_colorsn);

                                // grab a reference to the div header
                                var chk_color_area = document.getElementById('chk_color_area');

                                // append the new element to the div
                                chk_color_area.appendChild(circle_i);
                                chk_color_area.appendChild(circle_inksn).style.backgroundColor = colors[chk_color[i][0]];
                                chk_color_area.appendChild(arrow);
                                chk_color_area.appendChild(circle_colorsn).style.backgroundColor = colors[chk_color[i][1]];
                                $('#chk_color_area span').html('<i class="fa fa-long-arrow-right"></i>');
                            }
                        }
                    }
                };
                $('.color_check_block').show();
                $('.color_detection_block').hide();
                send('Ink_Check');
            }
            function postolocation(pos){
                var i = 0;
                $.each(pos, function(k,v){
                    locations['p'+i]= {x:v[0], y:v[1]};
                    //var p = "<div id='p"+i+"' class='p'></div>";
                    //$(p).appendTo('#container').css({'left':v[0], 'top':v[1]});
                    i++;
                });
            }
            function save_styleName(title){
                $('#save_done_form .link_title').html(title);
                show_page('.pag-save-done');
            }
            function draw_foundation(fid){
                doPix('photo_canvas', fid);
            }
            function doPix(canvasid, fid) {
                var img = document.getElementById('photo_img'),
                    canvas = document.getElementById(canvasid),
                    ctx = canvas.getContext("2d"),
                    P;
                var efcts = {
                    "103":{"brt":"0.0","ctr":"0","hue":"0.01","sat":"-0.01","lig":"0.01","lamt":"0"}, 
                    "104":{"brt":"0.1","ctr":"0","hue":"0.01","sat":"-0.01","lig":"0.02","lamt":"0"},
                    "105":{"brt":"0.2","ctr":"0","hue":"0.01","sat":"-0.01","lig":"0.03","lamt":"0"}, 
                    "106":{"brt":"0.2","ctr":"0","hue":"0.01","sat":"-0.01","lig":"0.03","lamt":"0.05"},
                    "107":{"brt":"0.2","ctr":"0","hue":"0.01","sat":"-0.01","lig":"0.03","lamt":"0.1"}
                };
                var cur_efct = efcts[fid];
                var effects = [{
                        effect : "brightness",
                        options : {
                                brightness : cur_efct.brt,
                                contrast : cur_efct.ctr
                            }
                    },{
                        effect : "hsl",
                        options : {
                            hue : cur_efct.hue,
                            saturation : cur_efct.sat,
                            lightness : cur_efct.lig
                        }
                    },{
                    effect : "lighten",
                        options : {
                            amount : cur_efct.lamt
                        }
                    }];
                canvas.width = 320;
                canvas.height = 320;
                ctx.drawImage(img,160, 0, 320, 320, 0, 0, 320, 320);
                P = new Pixastic(ctx, 'js/');
                $.each(effects, function(k,v){
                    P[v.effect](v.options).done(function() {

                    }, function(p) {
                        //console.log(p);
                    });
                });
            }
            function show_points(){
                $('.sho-points').show();
            }
            function downloadFile(){
                var fail = function(error){
                    console.log(error.code);
                };
                window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, 
                    function onFileSystemSuccess(fileSystem) {
                        fileSystem.root.getFile(
                        "dummy.html", {create: true, exclusive: false}, 
                        function gotFileEntry(fileEntry) {
                            var sPath = fileEntry.fullPath.replace("dummy.html","");
                            var fileTransfer = new FileTransfer();
                            fileEntry.remove();

                            fileTransfer.download(
                                "http://www.w3.org/2011/web-apps-ws/papers/Nitobi.pdf",
                                sPath + "theFile.pdf",
                                function(theFile) {
                                    console.log("download complete: " + theFile.toURI());
                                    showLink(theFile.toURI());
                                },
                                function(error) {
                                    console.log("download error source " + error.source);
                                    console.log("download error target " + error.target);
                                    console.log("upload error code: " + error.code);
                                }
                            );
                        }, fail);
                    }, fail);
                };
        </script>
        <script>
        $(document).ready(function () {
            window.addEventListener("beforeunload", function (e) {
                var confirmationMessage = '您是否確定要離開應用程式？';
                (e || window.event).returnValue = confirmationMessage; //Gecko + IE
                return confirmationMessage; //Gecko + Webkit, Safari, Chrome etc.
            });
            $('#togglePoints').click(function(){
                var ht = $(this).html();
                if(ht == 'Show'){
                    $(this).html('Hide');
                    $('.sho-points').show();
                }else{
                    $(this).html('Show');
                    $('.sho-points').hide();
                }
            });
            $('#debug').click(function(){
                $('#msg-code').toggle();
            });
            ctrack = new clm.tracker({stopOnConvergence : true});
            ctrack.init(pModel);
            // detect if tracker fails to find a face
            document.addEventListener("clmtrackrNotFound", function(event) {
                ctrack.stop();
                alert("The tracking had problems with finding a face in this image. Try selecting the face in the image manually.")
            }, false);

            // detect if tracker loses tracking of face
            document.addEventListener("clmtrackrLost", function(event) {
                ctrack.stop();
                alert("The tracking had problems converging on a face in this image. Try selecting the face in the image manually.")
            }, false);

            // detect if tracker has converged
            document.addEventListener("clmtrackrConverged", function(event) {
                var pos = ctrack.getCurrentPosition();
                postolocation(pos);
                draw_landmarks(pos);
            }, false);

            // update stats on iteration
            document.addEventListener("clmtrackrIteration", function(event) {
            }, false);
        });
        </script>
</body>
</html>
<!--
div class="detail_editor swiper-no-swiping">
    <div class="face_side_button" style="display:none">
        <a href="" class="left_btn select_btn">SELECT</a>
        <a href="" class="right_btn select_btn">SELECT</a>
    </div>
    <div class="footer_title"><img src="images/blush_icon.png"><span>BLUSH DETAILS</span></div>
    <div class="selected_color"></div>
    <div class="footer_list style_selected">
        <img src="images/blush_style1.png" />
    </div>
    <div class="details_setting_block">
        <div class="color_circle">
            <p>#001</p>
            <div class="circle_1"></div>
        </div>
        <div class="color_circle">
            <p>#002</p>
            <div class="circle_2"></div>
        </div>    
        <div class="color_circle">
            <p>#003</p>
            <div class="circle_3"></div>
        </div>    
        <div class="color_circle">
            <p>#004</p>
            <div class="circle_4"></div>
        </div>    
        <div class="color_circle">
            <p>#005</p>
            <div class="circle_5"></div>
        </div>    
        <div class="color_circle">
            <p>#006</p>
            <div class="circle_6"></div>
        </div>
        <div class="clear"></div>
        <div class="detail_slide_bar">
            <div class="slide_bar_less"><i class="fa fa-minus-square-o"></i></div>
            <div class="slide_bar_line"></div>
            <div class="slide_bar_add"><i class="fa fa-plus-square-o"></i></div>
            <div class="slide_bar_touch"><div class="slide_bar_square"></div></div>
            <div class="clear"></div>
            <a href="" class="move_btn"><i class="fa fa-arrows"></i> MOVE</a>
        </div>
    </div>
    <div class="clear"></div>
    <div class="makeup_style_funcs">
        <a class="link_title left_side btn_detail_edit half"><i class="fa fa-times-circle-o"></i>BACK</a>
        <a onclick="show_page('.pag-manual')" class="link_title right_side half"><i class="fa fa-question"></i>HELP</a>
    </div>
</div>

<ul class="style_share_list">
    <li><a class="btn_style_share"><i class="fa fa-angle-left"></i><span>回到樣式選擇</span></a></li> 
    <li><a><i class="fa fa-instagram"></i>INSTAGRAM</a></li>
    <li><a><i class="fa fa-facebook-square"></i>FACEBOOK</a></li>
    <li><a><i class="fa fa-envelope"></i>EMAIL</a></li>
    <li><a><i class="fa fa-twitter"></i>TWITTER</a></li>
</ul>
-->
